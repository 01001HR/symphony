var Gobang={unitSize:30,chessLength:600,drawChessBoard:function(){Gobang.chessCanvas.fillStyle="darkorange",Gobang.chessCanvas.fillRect(0,0,Gobang.chessLength,Gobang.chessLength),Gobang.chessCanvas.strokeStyle="black",Gobang.chessCanvas.lineWidth=10,Gobang.chessCanvas.strokeRect(0,0,Gobang.chessLength,Gobang.chessLength),Gobang.chessCanvas.lineWidth=1;for(var n=1;n<Gobang.chessLength/Gobang.unitSize;n++)Gobang.drawChessLine(n);Gobang.drawChessMan(5*Gobang.unitSize,5*Gobang.unitSize,5,"black"),Gobang.drawChessMan(15*Gobang.unitSize,5*Gobang.unitSize,5,"black"),Gobang.drawChessMan(5*Gobang.unitSize,15*Gobang.unitSize,5,"black"),Gobang.drawChessMan(15*Gobang.unitSize,15*Gobang.unitSize,5,"black")},drawChessLine:function(n){Gobang.chessCanvas.moveTo(0,n*Gobang.unitSize),Gobang.chessCanvas.lineTo(Gobang.chessLength,n*Gobang.unitSize),Gobang.chessCanvas.stroke(),Gobang.chessCanvas.moveTo(n*Gobang.unitSize,0),Gobang.chessCanvas.lineTo(n*Gobang.unitSize,Gobang.chessLength),Gobang.chessCanvas.stroke()},drawChessMan:function(n,a,e,s){Gobang.chessCanvas.fillStyle=s,Gobang.chessCanvas.beginPath(),Gobang.chessCanvas.arc(n,a,e,0,2*Math.PI,!0),Gobang.chessCanvas.fill()},getChessManPoint:function(n,a){var e=n.x,s=n.y;n.x=10*Math.floor(n.x/10),n.y=10*Math.floor(n.y/10);for(var o=n.x,t=n.x,g=n.y,i=n.y,h=0,r=0;t%30!=0;)t-=10;for(;o%30!=0;)o+=10;for(;i%30!=0;)i-=10;for(;g%30!=0;)g+=10;var c=new Array,b=new Array;if(c[0]=(o-e)*(o-e)+(g-s)*(g-s),b[c[0]]={x:o,y:g},c[1]=(o-e)*(o-e)+(i-s)*(i-s),b[c[1]]={x:o,y:i},c[2]=(t-e)*(t-e)+(g-s)*(g-s),b[c[2]]={x:t,y:g},c[3]=(t-e)*(t-e)+(i-s)*(i-s),b[c[3]]={x:t,y:i},c.sort(function(n,a){return n-a}),h=b[c[0]].x,r=b[c[0]].y,0!=h&&600!=h&&0!=r&&600!=r){var l={type:2,x:h,y:r,size:Gobang.unitSize,player:a};GobangChannel.ws.send(JSON.stringify(l))}},initCanvas:function(n,a){Gobang.chessCanvas=document.getElementById(a).getContext("2d"),Gobang.drawChessBoard()},getMousePos:function(n,a){var e=n.getBoundingClientRect();return{x:a.clientX-e.left*(n.width/e.width),y:a.clientY-e.top*(n.height/e.height)}},chatSend:function(){var n={type:1,player:$("#player").val(),message:$("#chatInput").val()};$("#chatArea").html($("#player").val()+" : "+$("#chatInput").val()),GobangChannel.ws.send(JSON.stringify(n))},moveChess:function(n){var a=Gobang.getMousePos(document.getElementById("gobangCanvas"),n);Gobang.getChessManPoint(a,$("#player").val())}},GobangChannel={ws:void 0,init:function(n){GobangChannel.ws=new ReconnectingWebSocket(n),GobangChannel.ws.reconnectInterval=1e4,GobangChannel.ws.onopen=function(){},GobangChannel.ws.onmessage=function(n){var a=JSON.parse(n.data);switch(a.type){case 1:$("#chatArea").html(a.player+" : "+a.message);break;case 2:if(Gobang.drawChessMan(a.posX,a.posY,Gobang.unitSize/2,a.color),null!=a.result&&""!=a.result){alert(a.result),document.getElementById("gobangCanvas").removeEventListener("click",Gobang.moveChess);var e=$("button.green");e.removeAttr("disabled").css("opacity","1").text(e.text().substr(0,e.text().length-3))}break;case 3:$("#chatArea").html("【系统】 : "+a.message);break;case 4:$("#chatArea").html("【系统】 : "+a.message),console.log(a.player),$("#player").val(a.player)}},GobangChannel.ws.onclose=function(){GobangChannel.ws.close()},GobangChannel.ws.onerror=function(n){console.log("ERROR",n)}}};