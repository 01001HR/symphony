var ArticleChannel={ws:void 0,init:function(e){ArticleChannel.ws=new ReconnectingWebSocket(e),ArticleChannel.ws.reconnectInterval=1e4,ArticleChannel.ws.onopen=function(){setInterval(function(){ArticleChannel.ws.send("-hb-")},18e4)},ArticleChannel.ws.onmessage=function(e){var n=JSON.parse(e.data);if(Label.articleOId===n.articleId)switch(n.type){case"comment":var a=parseInt($("#comments .comment-header .ft-smaller").text())+1;$("#comments .comment-header .ft-smaller").text(a+" "+Label.cmtLabel);var t="";0===$("#comments > ul > li").length&&($(".comment-header > .fn-none").show(),t='<div id="bottomComment"></div>',$("#comments > div > span:last").show());var o=Util.getDeviceByUa(n.commentUA);""!==o&&(o=' <span class="cmt-via fn-hidden hover-show">via '+o+"</span>");var l='<li id="'+n.commentId+'">'+t+'<div class="fn-flex">';if(n.fromClient?l+='<div class="avatar tooltipped tooltipped-se" aria-label="'+n.commentAuthorName+'" style="background-image:url('+n.commentAuthorThumbnailURL+')"></div>':("someone"!==n.commentAuthorName&&(l+='<a rel="nofollow" href="/member/'+n.commentAuthorName+'">'),l+='<div class="avatar tooltipped tooltipped-se" aria-label="'+n.commentAuthorName+'" style="background-image:url('+n.commentAuthorThumbnailURL+')"></div>',"someone"!==n.commentAuthorName&&(l+="</a>")),l+='<div class="fn-flex-1"><div class="comment-get-comment list"></div><div class="fn-clear comment-info ft-smaller"><span class="fn-left">',n.fromClient?l+='<span class="ft-gray">'+n.commentAuthorName+'</span> <span class="ft-fade"> • </span> <a rel="nofollow" href="https://hacpai.com/article/1457158841475">API</a>':("someone"!==n.commentAuthorName&&(l+='<a rel="nofollow" class="ft-gray" href="/member/'+n.commentAuthorName+'">'),l+='<span class="ft-gray">'+n.commentAuthorName+"</span>","someone"!==n.commentAuthorName&&(l+="</a>")),l+=' <span class="ft-fade"> • '+n.timeAgo,0===n.userUAStatus&&(l+=" "+o),l+='</span></span><span class="fn-right">',""!==n.commentOriginalCommentId&&(l+='<span class="fn-pointer ft-fade tooltipped tooltipped-nw" aria-label="'+Label.goCommentLabel+'" onclick="Comment.showReply(\''+n.commentOriginalCommentId+'\', this, \'comment-get-comment\')"><span class="icon-reply-to"></span>  <div class="avatar-small" style="background-image:url(\''+n.commentOriginalAuthorThumbnailURL+"')\"></div></span> "),Label.isAdminLoggedIn&&(l+='<a class="hover-show fn-hidden tooltipped tooltipped-n ft-a-icon" href="/admin/comment/'+n.commentId+'" aria-label="'+Label.adminLabel+'"><span class="icon-setting"></span></a> '),l+='</span></div><div class="content-reset comment">'+n.commentContent+'</div><div class="comment-action"><div class="ft-fade fn-clear"><span class="fn-right fn-hidden hover-show"><span class="fn-pointer tooltipped tooltipped-n"  aria-label="'+Label.thankLabel+'" onclick="Comment.thank(\''+n.commentId+"', '"+Label.csrfToken+"', '"+n.commentThankLabel+"',"+("someone"===n.commentAuthorName?1:0)+', this)"><span class="icon-heart"></span></span> <span class="tooltipped tooltipped-n fn-pointer" aria-label="'+Label.upLabel+' 0"onclick="Article.voteUp(\''+n.commentId+'\', \'comment\', this)"><span class="icon-thumbs-up"></span></span> <span class="tooltipped tooltipped-n fn-pointer"aria-label="'+Label.downLabel+' 0" onclick="Article.voteDown(\''+n.commentId+"', 'comment', this)\"><span class=\"icon-thumbs-down\"></span></span> ",(Label.isLoggedIn&&n.commentAuthorName!==Label.currentUserName||!Label.isLoggedIn)&&(l+=' <span aria-label="'+Label.replyLabel+'" class="fn-pointer tooltipped tooltipped-n" onclick="Comment.reply(\''+n.commentAuthorName+"', '"+n.commentId+'\')"><span class="icon-reply"></span></span> '),l+="</span></div></div></li>",0===Label.userCommentViewMode?$("#comments > ul").append(l):$("#comments > ul").prepend(l),Article.parseLanguage(),Comment._bgFade($("#"+n.commentId)),""!==n.commentOriginalCommentId){var i=$("#"+n.commentOriginalCommentId),s=i.find(".comment-action > .ft-fade > .fn-pointer");1===s.length?(s.html(" "+(parseInt($.trim(s.text()))+1)+" "+Label.replyLabel+' <span class="'+s.find("span").attr("class")+'"></span>'),"icon-chevron-up"===s.find("span").attr("class")&&(s.find("span").removeClass("icon-chevron-up").addClass("icon-chevron-down"),s.click())):i.find(".comment-action > .ft-fade").prepend('<span class="fn-pointer ft-smaller" onclick="Comment.showReply(\''+n.commentOriginalCommentId+"', this, 'comment-replies')\" style=\"opacity: 1;\"> 1 "+Label.replyLabel+' <span class="icon-chevron-down"></span>')}break;case"articleHeat":var c=$("#heatBar"),m=$(".heat");"+"===n.operation?(c.append('<i class="point"></i>'),setTimeout(function(){m.width($(".heat").width()+3),c.find(".point").remove()},2e3)):(m.width($(".heat").width()-3),c.append('<i class="point-remove"></i>'),setTimeout(function(){c.find(".point-remove").remove()},2e3));break;default:console.error("Wrong data [type="+n.type+"]")}},ArticleChannel.ws.onclose=function(){},ArticleChannel.ws.onerror=function(e){console.log(e)}}},ArticleListChannel={ws:void 0,init:function(e){ArticleListChannel.ws=new ReconnectingWebSocket(e),ArticleListChannel.ws.reconnectInterval=1e4,ArticleListChannel.ws.onopen=function(){setInterval(function(){ArticleListChannel.ws.send("-hb-")},18e4)},ArticleListChannel.ws.onmessage=function(e){var n=JSON.parse(e.data);$(".article-list .has-view h2 > a[rel=bookmark]").each(function(){var e=$(this).data("id").toString();if(n.articleId===e){var a=$(this).closest("li"),t=a.find(".heat");"+"===n.operation?(a.append('<i class="point"></i>'),setTimeout(function(){t.width(t.width()+3),a.find(".point").remove()},2e3)):(t.width(t.width()-3),a.append('<i class="point-remove"></i>'),setTimeout(function(){a.find(".point-remove").remove()},2e3))}})},ArticleListChannel.ws.onclose=function(){ArticleListChannel.ws.close()},ArticleListChannel.ws.onerror=function(e){console.log("ERROR",e)}}},TimelineChannel={ws:void 0,init:function(e,n){TimelineChannel.ws=new ReconnectingWebSocket(e),TimelineChannel.ws.reconnectInterval=1e4,TimelineChannel.ws.onopen=function(){setInterval(function(){TimelineChannel.ws.send("-hb-")},18e4)},TimelineChannel.ws.onmessage=function(e){var a=JSON.parse(e.data);switch($("#emptyTimeline").remove(),a.type){case"newUser":case"article":case"comment":case"activity":var t=(new Date).getTime(),o='<li class="fn-none" id='+t+">"+a.content+"</li>";$("#ul").prepend(o),$("#"+t).fadeIn(2e3);var l=$("#ul > li").length;l>n&&$("#ul > li:last").remove()}},TimelineChannel.ws.onclose=function(){TimelineChannel.ws.close()},TimelineChannel.ws.onerror=function(e){console.log("ERROR",e)}}},ChatRoomChannel={ws:void 0,init:function(e){ChatRoomChannel.ws=new ReconnectingWebSocket(e),ChatRoomChannel.ws.reconnectInterval=1e4,ChatRoomChannel.ws.onopen=function(){setInterval(function(){ChatRoomChannel.ws.send("-hb-")},18e4)},ChatRoomChannel.ws.onmessage=function(e){var n=JSON.parse(e.data);switch(n.type){case"online":$("#onlineCnt").text(n.onlineChatCnt);break;case"msg":var a=n.userAvatarURL.indexOf("user-thumbnail.png")<0,t='<a rel="nofollow" href="/member/'+n.userName+'"><div class="avatar tooltipped tooltipped-se" aria-label="'+n.userName+'" style="background-image:url('+n.userAvatarURL+')"></div></a>';a||(t='<div class="avatar tooltipped tooltipped-se" aria-label="'+n.userName+'" style="background-image:url('+n.userAvatarURL+')"></div>');var o='<a rel="nofollow" href="/member/'+n.userName+'">'+n.userName+"</a>";a||(o=n.userName);var l='<li class="fn-none"><div class="fn-flex">'+t+'<div class="fn-flex-1"><div class="fn-clear"><span class="fn-left">'+o+'</span></div><div class="content-reset comment">'+n.content+"</div></div></div></li>";0===$(".list ul li").length?$(".list ul").html(l):$(".list ul li:first").before(l),$(".list").scrollTop()<2*$("li").outerHeight()&&$(".list").animate({scrollTop:0},500),$("ul li:first").fadeIn(2e3)}},ChatRoomChannel.ws.onclose=function(){ChatRoomChannel.ws.close()},ChatRoomChannel.ws.onerror=function(e){console.log("ERROR",e)}}};