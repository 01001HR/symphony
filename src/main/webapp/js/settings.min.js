var Settings={update:function(type){var requestJSONObject={};switch(type){case"profiles":requestJSONObject=this._validateProfiles();break;case"sync/b3":requestJSONObject=this._validateSyncB3();break;case"password":requestJSONObject=this._validatePassword();break;default:console.log("update settings has no type")}if(!requestJSONObject){return}$.ajax({url:"/settings/"+type,type:"POST",cache:false,data:JSON.stringify(requestJSONObject),beforeSend:function(){$("#"+type.replace(/\//g,"")+"Tip").removeClass("tip-succ").removeClass("tip-error").text("")},success:function(result,textStatus){if(result.sc){$("#"+type.replace(/\//g,"")+"Tip").addClass("tip-succ").text(Label.updateSuccLabel).css({"border-left":"1px solid #78909B",})}else{$("#"+type.replace(/\//g,"")+"Tip").addClass("tip-error").text(result.msg).css({"border-left":"1px solid #E2A0A0",})}}})},_validateProfiles:function(){var URLVal=$("#userURL").val().replace(/(^\s*)|(\s*$)/g,""),QQVal=$("#userQQ").val().replace(/(^\s*)|(\s*$)/g,""),introVal=$("#userIntro").val().replace(/(^\s*)|(\s*$)/g,"");if(Validate.goValidate([{id:"userURL",type:"url",msg:Label.invalidUserURLLabel},{id:"userQQ",type:"12",msg:Label.invalidUserQQLabel},{id:"userIntro",type:"255",msg:Label.invalidUserIntroLabel}])){var data={};data.userURL=URLVal;data.userQQ=QQVal;data.userIntro=introVal;return data}return false},_validateSyncB3:function(){var keyVal=$("#soloKey").val().replace(/(^\s*)|(\s*$)/g,""),postURLVal=$("#soloPostURL").val().replace(/(^\s*)|(\s*$)/g,""),updateURLVal=$("#soloUpdateURL").val().replace(/(^\s*)|(\s*$)/g,""),cmtURLVal=$("#soloCmtURL").val().replace(/(^\s*)|(\s*$)/g,"");if(Validate.goValidate([{id:"soloKey",type:"20",msg:Label.invalidUserB3KeyLabel},{id:"soloPostURL",type:"150",msg:Label.invalidUserB3ClientURLLabel},{id:"soloUpdateURL",type:"150",msg:Label.invalidUserB3ClientURLLabel},{id:"soloCmtURL",type:"150",msg:Label.invalidUserB3ClientURLLabel}])){var data={};data.userB3Key=keyVal;data.userB3ClientAddArticleURL=postURLVal;data.userB3ClientUpdateArticleURL=updateURLVal;data.userB3ClientAddCommentURL=cmtURLVal;return data}return false},_validatePassword:function(){var pwdVal=$("#pwdOld").val(),newPwdVal=$("#pwdNew").val();if(Validate.goValidate([{id:"pwdOld",type:"password",msg:Label.invalidPasswordLabel},{id:"pwdNew",type:"password",msg:Label.invalidPasswordLabel},{id:"pwdRepeat",type:"confirmPassword|pwdNew",msg:Label.confirmPwdErrorLabel}])){if(newPwdVal!==$("#pwdRepeat").val()){return false}var data={};data.userPassword=calcMD5(pwdVal);data.userNewPassword=calcMD5(newPwdVal);return data}return false},init:function(){$("#userURL, #userQQ").keyup(function(event){if(event.keyCode===13){Settings.update("profiles")}});$("#userIntro").keyup(function(event){if(event.keyCode===13&&event.ctrlKey){Settings.update("profiles")}});$("#soloKey, #soloPostURL, , #soloUpdateURL, #soloCmtURL").keyup(function(event){if(event.keyCode===13){Settings.update("sync/b3")}});$("#pwdOld, #pwdNew, #pwdRepeat").keyup(function(event){if(event.keyCode===13){Settings.update("password")}})}};Settings.init();