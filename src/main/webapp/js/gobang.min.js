var Gobang={unitSize:30,chessLength:600,drawChessBoard:function(){Gobang.chessCanvas.fillStyle="rgb(255,229,143)",Gobang.chessCanvas.fillRect(0,0,Gobang.chessLength,Gobang.chessLength),Gobang.chessCanvas.strokeStyle="black",Gobang.chessCanvas.lineWidth=10,Gobang.chessCanvas.strokeRect(0,0,Gobang.chessLength,Gobang.chessLength),Gobang.chessCanvas.lineWidth=1;for(var a=1;a<Gobang.chessLength/Gobang.unitSize;a++)Gobang.drawChessLine(a);Gobang.drawChessMan(5*Gobang.unitSize,5*Gobang.unitSize,5,"black"),Gobang.drawChessMan(15*Gobang.unitSize,5*Gobang.unitSize,5,"black"),Gobang.drawChessMan(5*Gobang.unitSize,15*Gobang.unitSize,5,"black"),Gobang.drawChessMan(15*Gobang.unitSize,15*Gobang.unitSize,5,"black")},drawChessLine:function(a){Gobang.chessCanvas.moveTo(0,a*Gobang.unitSize),Gobang.chessCanvas.lineTo(Gobang.chessLength,a*Gobang.unitSize),Gobang.chessCanvas.stroke(),Gobang.chessCanvas.moveTo(a*Gobang.unitSize,0),Gobang.chessCanvas.lineTo(a*Gobang.unitSize,Gobang.chessLength),Gobang.chessCanvas.stroke()},drawChessMan:function(a,e,n,t){Gobang.chessCanvas.fillStyle=t,Gobang.chessCanvas.beginPath(),Gobang.chessCanvas.arc(a,e,n,0,2*Math.PI,!0),Gobang.chessCanvas.fill()},getChessManPoint:function(a,e){var n=a.x,t=a.y;a.x=10*Math.floor(a.x/10),a.y=10*Math.floor(a.y/10);for(var s=a.x,o=a.x,r=a.y,g=a.y,c=0,h=0;o%30!=0;)o-=10;for(;s%30!=0;)s+=10;for(;g%30!=0;)g-=10;for(;r%30!=0;)r+=10;var i=new Array,l=new Array;if(i[0]=(s-n)*(s-n)+(r-t)*(r-t),l[i[0]]={x:s,y:r},i[1]=(s-n)*(s-n)+(g-t)*(g-t),l[i[1]]={x:s,y:g},i[2]=(o-n)*(o-n)+(r-t)*(r-t),l[i[2]]={x:o,y:r},i[3]=(o-n)*(o-n)+(g-t)*(g-t),l[i[3]]={x:o,y:g},i.sort(function(a,e){return a-e}),c=l[i[0]].x,h=l[i[0]].y,0!=c&&600!=c&&0!=h&&600!=h){var b={type:2,x:c,y:h,size:Gobang.unitSize,player:e};GobangChannel.ws.send(JSON.stringify(b))}},initCanvas:function(a,e){Gobang.chessCanvas=document.getElementById(e).getContext("2d"),Gobang.drawChessBoard()},getMousePos:function(a,e){var n=a.getBoundingClientRect();return{x:e.clientX-n.left*(a.width/n.width),y:e.clientY-n.top*(a.height/n.height)}},chatSend:function(){var a={type:1,player:$("#player").val(),message:$("#chatInput").val()};$("#chatArea > textarea").text($("#playerName").val()+" : "+$("#chatInput").val()+"\n"+$("#chatArea > textarea").text()),GobangChannel.ws.send(JSON.stringify(a))},moveChess:function(a){var e=Gobang.getMousePos(document.getElementById("gobangCanvas"),a);Gobang.getChessManPoint(e,$("#player").val())}},GobangChannel={ws:void 0,init:function(a){GobangChannel.ws=new ReconnectingWebSocket(a),GobangChannel.ws.reconnectInterval=1e4,GobangChannel.ws.onopen=function(){},GobangChannel.ws.onmessage=function(a){var e=JSON.parse(a.data);switch(e.type){case 1:$("#chatArea > textarea").text(e.player+" : "+e.message+"\n"+$("#chatArea > textarea").text());break;case 2:Gobang.drawChessMan(e.posX,e.posY,Gobang.unitSize/2,e.color),null!=e.result&&""!=e.result&&(alert(e.result),document.getElementById("gobangCanvas").removeEventListener("click",Gobang.moveChess));break;case 3:$("#chatArea > textarea").text(e.message+"\n"+$("#chatArea > textarea").text()),$("#playerName").val(e.playerName);break;case 4:$("#chatArea > textarea").text(e.message+"\n"+$("#chatArea > textarea").text()),$("#player").val(e.player);break;case 5:$("#chatArea > textarea").text(e.message+"\n"+$("#chatArea > textarea").text()),$("#player").val(e.player),$("#playerName").val(e.playerName),console.log(e.chess);break;case 6:$("#chatArea > textarea").text(e.message+"\n"+$("#chatArea > textarea").text())}},GobangChannel.ws.onclose=function(){GobangChannel.ws.close()},GobangChannel.ws.onerror=function(a){console.log("ERROR",a)}}};